
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta name="description" content="Jerome Cukier - communicating with data" />
<meta name="keywords" content="" />
<link rel="stylesheet" type="text/css" href="http://www.jeromecukier.net/wp-content/themes/1024px/style.css" />
<link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="http://www.jeromecukier.net/feed/" />
<link rel="alternate" type="text/xml" title="RSS .92" href="http://www.jeromecukier.net/feed/rss/" />
<link rel="alternate" type="application/atom+xml" title="Atom 0.3" href="http://www.jeromecukier.net/feed/atom/" />
<link rel="pingback" href="http://www.jeromecukier.net/xmlrpc.php" />
<link href='http://fonts.googleapis.com/css?family=PT+Serif|Oswald' rel='stylesheet' type='text/css'>
<title>Jerome Cukier</title>

			<script type="text/javascript">//<![CDATA[
			// Google Analytics for WordPress by Yoast v4.2.8 | http://yoast.com/wordpress/google-analytics/
			var _gaq = _gaq || [];
			_gaq.push(['_setAccount', 'UA-27690071-1']);
							_gaq.push(['_trackPageview']);
			(function () {
				var ga = document.createElement('script');
				ga.type = 'text/javascript';
				ga.async = true;
				ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
				var s = document.getElementsByTagName('script')[0];
				s.parentNode.insertBefore(ga, s);
			})();
			//]]></script>
			<link rel='stylesheet' id='YoutubeShortcodeMargenn-css'  href='http://www.jeromecukier.net/wp-content/plugins/youtube-shortcode/youtube-shortcode.css?ver=3.5' type='text/css' media='all' />
<link rel='stylesheet' id='jetpack-widgets-css'  href='http://www.jeromecukier.net/wp-content/plugins/jetpack/modules/widgets/widgets.css?ver=20121003' type='text/css' media='all' />
<script type='text/javascript' src='http://www.jeromecukier.net/wp-includes/js/jquery/jquery.js?ver=1.8.3'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://www.jeromecukier.net/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://www.jeromecukier.net/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 3.5" />
<link rel='shortlink' href='http://wp.me/o630' />

<!-- Jetpack Open Graph Tags -->
<meta property="og:type" content="blog" />
<meta property="og:title" content="Jerome Cukier" />
<meta property="og:description" content="communicating with data" />
<meta property="og:url" content="http://www.jeromecukier.net/" />
<meta property="og:site_name" content="Jerome Cukier" />
<meta id="syntaxhighlighteranchor" name="syntaxhighlighter-version" content="3.1.3" />


</head>

<body>
<div id="wrap">

<div id="header">
<h1><a href="http://www.jeromecukier.net">Jerome Cukier</a></h1>
<p id="slogan">communicating with data</p>
</div><div id="content"><h2>Selections in d3 &#8211; the long story</h2><div class="contenttext"><p>This past week, Scott Murray and I presented a tutorial at Strata on d3 (of all things!)<br />
First things first, you probably want to get <a href="http://amzn.com/1449339735" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://amzn.com']);">Scott&#8217;s book on the subject</a> when it&#8217;s out. I should be translating it into French eventually.<br />
You&#8217;re also welcome to the slides and examples of the tutorial which can be found on <a href="https://github.com/alignedleft/strata-d3-tutorial" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://github.com']);">https://github.com/alignedleft/strata-d3-tutorial</a>. That include my <a href="https://github.com/alignedleft/strata-d3-tutorial/blob/master/d3%20Cheat%20Sheet.pdf" onclick="javascript:_gaq.push(['_trackEvent','download','http://github.com/alignedleft/strata-d3-tutorial/blob/master/d3%20Cheat%20Sheet.pdf']);">d3 cheat sheet</a>.</p>
<p>We had done a d3 workshop a few months back at Visweek with Jeff Heer. This time around, we changed our approach: we covered less ground, went at a slower pace, but targeted what is in our opinion the most troublesome aspects of learning d3: selecting, creating and removing elements. </p>
<p>I have learned d3 from deciphering script examples and in the earliest ones one ubiquitous construct was this sequence : select / selectAll / data / enter / append.<br />
It does the work, so like everyone else I&#8217;ve copied it and reused very often. It happens to be the most proper way of adding new elements in most cases, but the point is, while learning d3, I (and many people before and after me) have copy/pasted it without understanding it deeply. Though, copy pasting something you don&#8217;t understand thoroughly is the best way to get errors you don&#8217;t understand any better, and it would prevent you from accessing the rest of the potential of the library. Conversely, once this is cleared, you can be &#8220;thinking in d3&#8243; and easily do many things you might have thought impossible before.</p>
<p>We did the tutorial hands-on, live coding most of the time. To follow through, I invite you to create or open an empty page with d3 loaded (such as <a href="http://www.jeromecukier.net/projects/template.html"  title="d3 template" target="_blank">this one</a> &#8211; the link opens a new tab) and then open the &#8220;console&#8221; or &#8220;web developer tools&#8221; which allow you to type javascript statements directly, without having to write and load scripts. Here are the shortcuts to the console: </p>
<ul>
<li>Chrome: Ctrl-J (windows), ⌥ ⌘+j (Mac)</li>
<li>Firefox: Ctrl+Shift+k (windows), ⌥ ⌘+k (Mac)</li>
<li>Safari: Ctrl+Alt+c (windows), ⌥ ⌘+c (Mac)</li>
<li>IE9+: F12</li>
</ul>
<p>To make the best of this tutorial, please type the examples. Some tutorials show you impressive stuff and show you step by step how to do it. That&#8217;s not one of them. I&#8217;ve sticked to very, very basic and mundane things. We&#8217;ll be only manipulating HTML elements such as paragraphs, which I assume you have seen earlier (plot twist: you are reading one at this very moment)<br />
Some of the code snippets don&#8217;t work. That&#8217;s the idea! I think you can&#8217;t progress by merely copying code that works. It&#8217;s important that you try out code that looks reasonable but that doesn&#8217;t produce the expected result or that causes an error, but then understand why. </p>
<h2>Adding simple stuff</h2>
<h3>Creating elements</h3>
<p>Our empty page is, well, empty, so we are going to add stuff.<br />
to create elements, we need the <strong>append</strong> method in d3, which takes as an argument the type of element that needs to be created, while the <strong>html</strong> method at the end allow us to specify a text.</p>
<p>so let&#8217;s go ahead and type: </p>
<pre class="brush: jscript; title: ; notranslate" title="">d3.append(&quot;h1&quot;).html(&quot;My beautiful text&quot;)</pre>
<p> and see what happens.</p>
<p>what do we get? and why is that?<br />
In d3, every element which is created cannot appear out of thin air, and must be <strong>added to a container</strong>. If we don&#8217;t specify a container element, we just can&#8217;t create anything.<br />
In HTML, most elements can be containers, that is, it&#8217;s usually possible to add elements to almost everything. Then again, our template is fairly empty, so we can select the <body> tag and take it from there.</p>
<pre class="brush: jscript; title: ; notranslate" title="">d3.select(&quot;body&quot;).append(&quot;h1&quot;).html(&quot;My beautiful text&quot;)</pre>
<p>we&#8217;re in business! as long as there is a sensible place to put them, you can create as much stuff as you like. Since we&#8217;re on a roll, why won&#8217;t we throw in a few paragraphs (<strong>p</strong> element in HTML):</p>
<pre class="brush: jscript; title: ; notranslate" title="">d3.select(&quot;body&quot;).append(&quot;p&quot;).html(&quot;Look at me, I'm a paragraph.&quot;)
d3.select(&quot;body&quot;).append(&quot;p&quot;).html(&quot;And I'm another paragraph!&quot;)
d3.select(&quot;body&quot;).append(&quot;p&quot;).html(&quot;Woohoo! number 3 baby&quot;)</pre>
<p>and lo and behold, all our paragraphs appear in sequence. Simply beautiful.<br />
But wait! paragraphs are containers, too. Why don&#8217;t we try to add a <strong>span</strong> element to one paragraph? For those of you with no HTML knowledge, span elements are like paragraphs, except there is no line break by default at the end. </p>
<p>So let&#8217;s try this:</p>
<pre class="brush: jscript; title: ; notranslate" title="">d3.select(&quot;p&quot;).append(&quot;span&quot;).html(&quot;and I'm a span!&quot;)</pre>
<p>Before typing it, take a minute to think where you expect it to go.<br />
Then go ahead and type it.</p>
<p>Surprised?<br />
you may have guessed that our new bit of text could go on a line of its own at the end of the document, or at the end of the last paragraph. But instead, it goes at the end of the first paragraph.<br />
Why is that? well, our select method stops the first instance of whatever it tries to find. In our case, since we asked it to find paragraphs &#8211; p, it stopped at the first p element it found, and added the span at the end of it (app<em>end</em>).</p>
<h3>Beyond creating new things</h3>
<p>adding new elements to a page programmatically is kind of useful, but if d3 stopped at that you probably wouldn&#8217;t be so interested in this tutorial to begin with. You can also modify and manipulate elements. We&#8217;ve done that to some extent with the html method. But we can also modify the <em>style</em> of the elements, their <em>attributes</em> and their <em>properties</em>. For the time being, don&#8217;t bother too much about the difference between these three things. Style refers to the appearance of elements, attributes, to their structure, and properties, to what can be changed in realtime, like values in a form. But again, let&#8217;s not worry about that for now and let&#8217;s just follow along. Look at this code snippet:</p>
<pre class="brush: jscript; title: ; notranslate" title="">d3.select(&quot;p&quot;).style(&quot;color&quot;,&quot;red&quot;)</pre>
<p>this will select the first paragraph and change its style, so that the text color is changed to red.<br />
But wait! our first paragraph, isn&#8217;t that the one with a span at the end of it? What will happen to that bit of text? Well, type the statement to find out.<br />
All the paragraph, including its children (that is, everything added to it, in our case the span) is turned to red.</p>
<pre class="brush: jscript; title: ; notranslate" title="">d3.select(&quot;span&quot;).style(&quot;color&quot;,&quot;blue&quot;)</pre>
<p>That singles out our span and writes it in blue. Can this be overturned?</p>
<pre class="brush: jscript; title: ; notranslate" title="">d3.select(&quot;p&quot;).style(&quot;color&quot;,&quot;red&quot;)</pre>
<p>That won&#8217;t change a thing. Our first paragraph is, in fact, already red. But its child, the span, has a style which overrides that of its parent. To have it behave like the rest, we can remove its style like so: </p>
<pre class="brush: jscript; title: ; notranslate" title="">d3.select(&quot;span&quot;).style(&quot;color&quot;,null)</pre>
<p>then </p>
<pre class="brush: jscript; title: ; notranslate" title="">d3.select(&quot;p&quot;).style(&quot;color&quot;,&quot;green&quot;)</pre>
<p>it will behave like its parent, the paragraph.<br />
But let&#8217;s try something else: </p>
<pre class="brush: jscript; title: ; notranslate" title="">d3.select(&quot;span&quot;).style(&quot;color&quot;,&quot;blue&quot;)</pre>
<p>we write our span in blue, </p>
<pre class="brush: jscript; title: ; notranslate" title="">d3.select(&quot;span&quot;).style(&quot;color&quot;,&quot;green&quot;)</pre>
<p>and now back in green, like its parent.</p>
<pre class="brush: jscript; title: ; notranslate" title="">d3.select(&quot;p&quot;).style(&quot;color&quot;,&quot;red&quot;)</pre>
<p>What will happen?<br />
well, the paragraph turns red, but the span doesn&#8217;t. It&#8217;s still following its specific instruction to be written in green.</p>
<p>That goes to illustrate that children behave like their parents, unless they are given specific instructions. </p>
<p>For HTML elements, we can play with styles, not so much with attributes or properties. One thing worth noting though is that an element can be given a class or an id.</p>
<p>Classes and ids can be used to style elements using a cascading style sheet (CSS). Knowing how CSS works is entirely facultative in learning d3, since d3 by itself can take care of all styling needs. Though, knowing basic CSS is not the most useless of endeavors, and some sensible CSS statements can save a lot of tedious manipulation in d3.<br />
The other use of classes and ids is that they can be used to select elements.</p>
<p>Let&#8217;s reload our page so we start from scratch.</p>
<pre class="brush: jscript; title: ; notranslate" title="">d3.select(&quot;body&quot;).append(&quot;p&quot;).html(&quot;First paragraph&quot;);
d3.select(&quot;body&quot;).append(&quot;p&quot;).html(&quot;Second paragraph&quot;).attr(&quot;class&quot;,&quot;p2&quot;);
d3.select(&quot;body&quot;).append(&quot;p&quot;).html(&quot;Third paragraph&quot;).attr(&quot;id&quot;,&quot;p3&quot;);
</pre>
<p>without the use of classes and ids, it&#8217;s still possible to select and manipulate the 2nd or 3rd instance of an element, but it&#8217;s a chore. You have to use <em>pseudo-classes</em> like d3.select(&#8220;p:nth-of-type(2)&#8221;) to select the 2nd instance of a paragraph, for instance.<br />
Personally, I&#8217;d rather avoid this and prefer using simpler statements. With classes and IDs set, we can write instead: </p>
<pre class="brush: jscript; title: ; notranslate" title="">d3.select(&quot;.p2&quot;).html(&quot;I'm classy&quot;);
d3.select(&quot;#p3&quot;).html(&quot;I've got ideas&quot;);</pre>
<p>To select things of a given class, you must use a period before the name of the class. To select things of a certain id, you must use the hash sign.<br />
Here, we are looking for the first element of the p2 class. This happens to be our 2nd paragraph. When you know you will have to manipulate elements which are not easily accessible, you may as well give them classes which will make this easier down the road.</p>
<p>In theory, there should only be one element of a given ID in one page, so I recommend not using them dynamically unless you can be 100% sure that there will not be duplicates. And, in case you were wandering, one element can have several (even many) classes. </p>
<h2>Two birds, one stone</h2>
<h3>Introducing selectAll</h3>
<p>So far, we&#8217;ve changed properties of one element at a time. The exception was when we changed the colors of both a paragraph and a span, but even then, we were still technically only changing the characteristics of one paragraph, which its child, the span, just happened to inherit. </p>
<p>For a complex document, that can be super tedious, especially since we&#8217;ve seen that it&#8217;s not easy to retrieve an element which is not the first of its kind.</p>
<p>so let&#8217;s go ahead and type:</p>
<pre class="brush: jscript; title: ; notranslate" title="">d3.selectAll(&quot;p&quot;).style(&quot;font-weight&quot;,&quot;bold&quot;);</pre>
<p>(for a little variety. I mean, changing text color is so 1994.)<br />
What was that? Everything turned to bold!</p>
<p>Indeed: while the select method returns the first element that matches the clause, selectAll matches them all.<br />
Let&#8217;s do more.<br />
We&#8217;re going to add a span to our first paragraph. </p>
<pre class="brush: jscript; title: ; notranslate" title="">d3.select(&quot;p&quot;).append(&quot;span&quot;)
.html(&quot;I'm a rebel child.&quot;)
.style(&quot;background-color&quot;,&quot;firebrick&quot;)</pre>
<p>we&#8217;re adding a gratuitous styling command.<br />
Now, let&#8217;s change the background color of all the paragraphs.</p>
<pre class="brush: jscript; title: ; notranslate" title="">d3.selectAll(&quot;p&quot;).style(&quot;background-color&quot;,&quot;aliceblue&quot;)</pre>
<p>As could be expected, the span doesn&#8217;t change its background color, and so it appears differently from its parent (which could be a desired effect &#8211; this gives us flexibility).<br />
but what if we wanted to change the background color of everything? can we do better?</p>
<pre class="brush: jscript; title: ; notranslate" title="">d3.selectAll(&quot;*&quot;).style(&quot;background-color&quot;,&quot;whitesmoke&quot;)</pre>
<p> (quite fitting in these times of papal conclave)</p>
<p>Well &#8211; everything gets a background color of &#8220;white smoke&#8221; (which is a fine background color btw.). Including the &#8220;body&#8221; element &#8211; that is, everything on the page!<br />
selectAll(&#8220;*&#8221;) matches everything. With it, you can grab all the children, their children etc. (&#8220;descendants&#8221;. I know&#8230;) of a selection, or, if used directly like so: d3.selectAll(&#8220;*&#8221;), everything on the page.<br />
So we&#8217;ve seen we can select moaar. But can we be finer? Can we select the paragraphs and the spans only, without touching the rest?</p>
<p>we sure can!</p>
<pre class="brush: jscript; title: ; notranslate" title="">d3.selectAll(&quot;p, span&quot;).style(&quot;background-color&quot;,&quot;lawngreen&quot;)</pre>
<p>The outcome of that one statement probably won&#8217;t make it to our web design portfolio, but it does the trick: you can select as much as you like, or as little as you like. </p>
<h3>Nested selections</h3>
<p>To illustrate the next situation, let&#8217;s add a span to our document.</p>
<pre class="brush: jscript; title: ; notranslate" title="">d3.select(&quot;body&quot;).append(&quot;span&quot;).html(&quot;select me if you can&quot;)</pre>
<p>Well, just like there is a way to select directly the 2nd paragraph using pseudo classes, there&#8217;s also a (complicated) way to select directly that last span (namely: selectAll(&#8220;span:not(p)&#8221;) )<br />
there&#8217;s also a simpler way which is what we&#8217;re interested in.<br />
let&#8217;s suppose we want to turn it to bold:<br />
we can just do</p>
<pre class="brush: jscript; title: ; notranslate" title="">d3.selectAll(&quot;span&quot;).style(&quot;font-weight&quot;,&quot;bold&quot;);</pre>
<p>then change the first one: </p>
<pre class="brush: jscript; title: ; notranslate" title="">d3.select(&quot;p&quot;).select(&quot;span&quot;).style(&quot;font-weight&quot;,null);</pre>
<p>Admittedly, the complicated way is more compact. But conceptually, the &#8220;simple&#8221; way is easier to follow: we can do a selection, and within that selection perform a newer selection, and so on and so forth. That way, we can get away with just using super simple selectors, as opposed to master the intricacies of CSS3 syntax. Do it for the people who will read your source code <img src='http://www.jeromecukier.net/wp-includes/images/smilies/icon_smile.gif' alt=':)' class='wp-smiley' /> </p>
<p><strong>At this point: </strong></p>
<ul>
<li>You know how to dynamically create content. Pretty cool!</li>
<li>More! you can dynamically change every property of every element of the page. woot!</li>
<li>Bonus! you&#8217;re equipped with tactics to easily reach any element you want to change.</li>
</ul>
<p>You should also have a good grasp of d3.select, d3.selectAll and the difference between the two.<br />
what more could you possibly want? Well, since this is about data visualization, how about a way to tie our elements to data? This is what d3 is really about.</p>
<h2>Putting the data in data visualization</h2>
<h3>Introducing data: passing values to many elements at once</h3>
<p>So far, we&#8217;ve entered &#8220;hard coded&#8221; values for all of our variables. That&#8217;s fine, but we can&#8217;t really set our elements one by one. I mean, we could, but it&#8217;s no way to &#8220;industrialize&#8221; the way elements are created.<br />
Fortunately, d3 provides. Its more interesting characteristic is the ability to &#8220;bind&#8221; elements with data.</p>
<p>If you&#8217;ve followed the instructions step by step, you should have 3 paragraphs in the page. Plus a span afterwards, but whatever.<br />
Let&#8217;s introduce the data method. This will match an array of values to a selection of elements in the page. Let&#8217;s go: </p>
<pre class="brush: jscript; title: ; notranslate" title="">var fs=[&quot;10px&quot;,&quot;20px&quot;,&quot;30px&quot;];
d3.selectAll(&quot;p&quot;).data(fs).style(&quot;font-size&quot;,function(d) {return d;})
</pre>
<p>wow wow wow what just happened?<br />
First, we create an array of values which we intelligently call fs (for font size).<br />
Then, right after the selectAll(&#8220;p&#8221;) which gathers a selection of elements (3 &#8220;p&#8221; elements to be exact), we specify a dataset using the data method.<br />
It just happens that our dataset has just the same number of items as our selection of elements!</p>
<p>finally, we use style, like we used to, with a twist: instead of providing one fixed value, which would affect our 3 p elements in the same way, we specify a function.<br />
This function will parse the dataset, and for each element, it will return the result of an operation in the corresponding data point: the result of the function on the first item for the first p element, the result on the 2nd item for our 2nd paragraph, and lastly the result on the last item for our last paragraph.<br />
We write the function with an argument: d. What is d? it&#8217;s nothing but a convention. We can call it anything. d is standard fare in d3 code because that&#8217;s the writing style of Mike Bostock, the author of the framework and of many of its examples.<br />
This function is nothing special, it returns the element itself, so we are passing &#8220;10px&#8221; for the font-size of our first paragraph, and so on and so forth (20px, 30px).<br />
As an aside, we can use the String function, which converts any element into a string, instead of writing function(d) {return d;}. So: </p>
<pre class="brush: jscript; title: ; notranslate" title="">d3.selectAll(&quot;p&quot;).data(fs).style(&quot;font-size&quot;,String)</pre>
<p> would also work and is shorter to write.</p>
<p>Let&#8217;s recap what just happened here, because this is important.<br />
We want to apply a dynamic transformation to a bunch of existing elements, as opposed to finding a way to select each individual element, and passing it a hard-coded value.<br />
What&#8217;s more, we want to apply a transformation of the same nature, but of a different magnitude, on each of these items. </p>
<p>How to proceed?<br />
well, first we create an array of values. That&#8217;s our fs boy over there.</p>
<pre class="brush: jscript; title: ; notranslate" title="">var fs=[&quot;10px&quot;,&quot;20px&quot;,&quot;30px&quot;];</pre>
<p>Then, we will first select all of the elements we want to modify, then we&#8217;ll tie our dataset to that selection. This is what selectAll, then data does.</p>
<pre class="brush: jscript; title: ; notranslate" title="">var selection=d3.selectAll(&quot;p&quot;).data(fs);</pre>
<p>By the way, I&#8217;ve stored the result of the selectAll then data in a variable. In the original example, I just &#8220;chained&#8221; the methods, that is, I followed each method by a period and another one. The two syntaxes are equivalent. Chaining works, because each of these methods returns a value which is itself a selection on which further operations can be done. This syntax works well through most of d3 with some exceptions which will be duly noted.</p>
<p>Then, we are going to change the style of the selection, using a function on our data.</p>
<pre class="brush: jscript; title: ; notranslate" title="">selection.style(&quot;font-size&quot;,function(d) {return d;})</pre>
<p> (or
<pre class="brush: jscript; title: ; notranslate" title="">selection.style(&quot;font-size&quot;,String)</pre>
<p>That function will run on each value of our dataset, and return one result per value, which will be passed to all elements in sequence.</p>
<p>At this stage you may have two questions:</p>
<ul>
<li>Can we use more sophisticated functions, because this one is kind of meh?</li>
<li>What happens if there is not the same number of items in the dataset and of elements?</li>
</ul>
<p>The second question is actually more complicated than the first, but we&#8217;ll answer it in painstaking detail.<br />
So let&#8217;s take care of the question on functions first.<br />
Yes, obviously, we can use the function not just to return the element, but to do any kind of calculation that a language such as javascript is capable of, which is nearly everything.<br />
To illustrate that, here are some variations of our initial code which will return the same result, but with a different form.</p>
<pre class="brush: jscript; title: ; notranslate" title="">
var fs=[10,20,30]; // no more px
d3.selectAll(&quot;p&quot;).data(fs).style(&quot;font-size&quot;,function(d) {return d+&quot;px&quot;;})
</pre>
<p>Here, instead of returning just the element, we append &#8220;px&#8221; at its end. Sadly, style(&#8220;font-size&#8221;,10) doesn&#8217;t work, but style(&#8220;font-size&#8221;,10+&#8221;px&#8221;) &#8211; which is the same as style(&#8220;font-size&#8221;,&#8221;10px&#8221;) is valid. </p>
<p>Here is yet another way.</p>
<pre class="brush: jscript; title: ; notranslate" title="">d3.selectAll(&quot;p&quot;).style(&quot;font-size&quot;,function(d,i) {return 10*(i+1)+&quot;px&quot;;})</pre>
<p>function(d,i) ? what is this devilry?<br />
Here, i (or anything we want to call it, as long as it&#8217;s the 2nd argument of this function) represents the order of the element in the selection, so the first gets a 0, the second a 1, etc. (well, in our example it goes to 3 elements, so the last one gets a 2).<br />
This may be a bit abstract to say here, but even if we haven&#8217;t passed data, this would still work &#8211; i represent the order of the element, not the data item. so, if no data had been passed, within this function call, d would be undefined, but i would still be equal to 0,1,2, &#8230; </p>
<p>The answer to the second question is the last great mystery of d3. Once you get this, you&#8217;re golden.</p>
<h3>Creating or removing the right number of elements depending on data</h3>
<p>Before we get further, let&#8217;s quickly introduce append&#8217;s reckless cousin, remove(). Writing remove at the end of a selection deletes all the corresponding elements from the document object model.<br />
so,
<pre class="brush: jscript; title: ; notranslate" title="">d3.selectAll(&quot;p&quot;).remove()</pre>
<p> would remove our 3 paragraphs. Let&#8217;s do it and get rid of our paragraphs.<br />
Actually, let&#8217;s do
<pre class="brush: jscript; title: ; notranslate" title="">d3.select(&quot;body&quot;).selectAll(&quot;*&quot;).remove()</pre>
<p> and remove everything below the body.</p>
<p>Now, earlier, we were alluding to what could happen if we didn&#8217;t have the same number of elements as of items in our dataset.</p>
<p>That means that we should be able to do the following: </p>
<ul>
<li>If there are fewer elements than items in a dataset, create the missing elements</li>
<li>If there are fewer elements than items in a dataset, disregard the extra data items</li>
<li>If there are more elements than items in a dataset, remove the extra elements</li>
<li>If there are more elements than items in a dataset, don&#8217;t change the extra elements/li>
<li>As data are updated, keep some elements, remove some, add some</li>
</ul>
<p>Why would we want to do all of this?<br />
The first case is the most common. When we start a data visualization script, chances are that there are no elements yet but there is data, so you&#8217;ll want to add elements based on the data.<br />
Then, if you have interaction or animation, your dataset may be updated, and depending on what you intend to do you may just want to update the existing elements, create new ones, remove old ones, etc. That&#8217;s when you may want to do 2, 3 or 4.<br />
The last (5th case) is more complicated, but don&#8217;t worry, we&#8217;ve got you covered.</p>
<p>Right now, we should have 0 p elements on our page (and if for some reason this is not the case, feel free to reload it).</p>
<p>let&#8217;s create a variable like so: </p>
<pre class="brush: jscript; title: ; notranslate" title="">var text=[&quot;first paragraph&quot;,&quot;second paragraph&quot;,&quot;third paragraph&quot;];</pre>
<p>somewhat uninspired, I know, but let&#8217;s keep typing to a minimum, if you want to go all lyrical please go ahead.</p>
<p>We are smack in case 1: we&#8217;d like to create 3 paragraphs, we have 3 items in our dataset, but 0 elements yet.<br />
Here&#8217;s what we&#8217;ll type: </p>
<pre class="brush: jscript; title: ; notranslate" title="">d3.select(&quot;body&quot;).selectAll(&quot;p&quot;).data(text).enter().append(&quot;p&quot;).html(String)</pre>
<p>A-ha! we meet again, select selectAll data enter append.<br />
After all we&#8217;ve done, select selectAll should make some sense, even though, at this stage, this selection returns 0 p elements. There are none yet.<br />
Then we pass data as we&#8217;ve done before. Note that there are 3 items in our dataset.</p>
<p>Then, we use the enter() statement. What it does is that it prepares one new element for every unmatched data item. We&#8217;ll expand a bit later on the true meaning of unmatched, but for the time being, let&#8217;s focus on the difference. We have 0 elements, but 3 data items. 3 &#8211; 0 = 3, so the enter() selection will prepare 3 new elements.<br />
What does prepare means? the elements are not created yet at this stage, but they will with the next command. Right after enter(), think of what&#8217;s created as placeholders for future element (Scott&#8217;s vocabulary), or buds that will eventually blossom into full-fledge elements (mine).<br />
After enter(), we specify an append(&#8220;p&#8221;) command. Previously, when we had used the append method, we created one element at a time. But in this case, we are going to create as many as there are placeholders returned by enter(). So, in our case, 3.<br />
You may legitimately wonder why we needed a select statement to begin with &#8211; after all, enter() works on the difference between selectAll and data. But when we are going to append elements, we will need to create them somewhere, to build them upon a container. This is what the first select does. Omit it, and you&#8217;ll have an error, because the system will be asked to create something without knowing where.<br />
The final method, html, will populate our paragraphs with text. The String function, which we have already seen, simply returns the content of each item in our dataset. </p>
<p>We&#8217;re using select > selectAll > data > enter > append, but hopefully you will see why (and if you don&#8217;t, hang on to the end of the article, and feel free to ask questions).</p>
<p>But let&#8217;s recap once more. Actually, let&#8217;s see the many ways to get this wrong (or, surprisingly, right)</p>
<pre class="brush: jscript; title: ; notranslate" title="">d3.selectAll(&quot;p&quot;).data(text).enter().append(&quot;p&quot;).html(String)</pre>
<p>We&#8217;ve alluded to that: without a container to put them in, p elements can&#8217;t be created. This will result in a DOM error.</p>
<pre class="brush: jscript; title: ; notranslate" title="">d3.select(&quot;body&quot;).selectAll(&quot;p&quot;).data(text).append(&quot;p&quot;).html(String)</pre>
<p>No enter statement. After the selectAll, the selection has 0 items. This doesn&#8217;t change after the data method. As such, append creates 0 new elements, and nothing changes in the document. (but no error though)</p>
<pre class="brush: jscript; title: ; notranslate" title="">d3.select(&quot;body&quot;).data(text).selectAll(&quot;p&quot;).enter().append(&quot;p&quot;).html(String)</pre>
<p>In many cases in d3, it&#8217;s ok to switch the order of chained methods, but that&#8217;s not true here. selectAll must come before data. We bind data to elements. The other way round would have made sense, but that&#8217;s the way it is. First selectAll, then data. Here, we get an error, because enter() can&#8217;t be fired directly from selectAll. </p>
<pre class="brush: jscript; title: ; notranslate" title="">d3.select(&quot;body&quot;).selectAll(&quot;wootwoot&quot;)
.data(text).enter().append(&quot;p&quot;).html(String)</pre>
<p>This actually works. Why?<br />
There are actually 0 elements of type &#8220;wootwoot&#8221; in our document, which may or may not surprise you. There are still 3 items in the dataset, so enter() returns space for 3 new elements. the next append subsequently creates 3 p elements, which are populated by the html method.<br />
It usually makes more sense to use the same selector in the selectAll and the append methods, but that&#8217;s not always the case. Sometimes, you will be selecting elements of a specific class, but in an append method, you have to specify the name of an element, not any selector. So you&#8217;d go </p>
<pre class="brush: jscript; title: ; notranslate" title="">d3.select(&quot;body&quot;).selectAll(&quot;.myClass&quot;)
.data(text).enter().append(&quot;p&quot;).html(String).attr(&quot;class&quot;,&quot;myClass&quot;)</pre>
<p>Now that we&#8217;ve seen a few variations on the subject, here is a really cool use of enter. Check this out: </p>
<pre class="brush: jscript; title: ; notranslate" title="">d3.select(&quot;body&quot;).selectAll(&quot;h1&quot;).data([{}]).enter().insert(&quot;h1&quot;).html(&quot;My title&quot;)</pre>
<p>ok there are 3 things here worth mentioning. 2 are just for show, though it doesn&#8217;t hurt to know them, but the 3rd one is really neat and useful.<br />
In data, we&#8217;ve passed: [{}]. This is an array of one object which is empty. There are two interesting things with that construct, one is that there&#8217;s only one element, the other one is that it&#8217;s an object. When you pass objects, the functions you run on them (like in the attr or style methods) can be used to add properties to them or change them. If that doesn&#8217;t make sense yet, just accept for now that it gives you more flexibility than using, say, [0].<br />
We&#8217;ve used insert instead of append. What this means is that we&#8217;re adding things before the first child of our container, not at the end (ie after the last child). In other words, our h1 (a title) will go at the top of the body element &#8211; fitting.</p>
<p>But what&#8217;s really interesting is what would happen if you were to run that statement again &#8211; nothing. try it. See?<br />
Why is that? Well, on your first go, at a point where there are no h1 elements yet, it works the standard way &#8211; you do a selectAll that returns nothing, you bind a dataset with more elements, then enter prepares space for the unmatched elements &#8211; 1 in our case &#8211; and then append creates that element. You may notice that the html part doesn&#8217;t use the data.<br />
When you run it again, the selectAll finds one h1 element, there&#8217;s still one item in the dataset, so enter won&#8217;t find any unmatched element, so the subsequent append is ignored. </p>
<p>So, you can run this kind of thing in a loop safely, it will only do what it&#8217;s supposed to do on the first go, it will be ignored afterwards. Don&#8217;t be afraid to use this construct for all the unique parts of your visualization, so you won&#8217;t have to worry about creating them multiple times.</p>
<h3>Other cases of mismatch between data items and elements</h3>
<p>All right, so now we have 3 p elements and 3 items in our dataset.<br />
What happens if we do this: </p>
<pre class="brush: jscript; title: ; notranslate" title="">text2=[&quot;hello world&quot;]
d3.selectAll(&quot;p&quot;).data(text2).html(String)</pre>
<p> ?</p>
<p>There is now one item in the data set, versus 3 p elements. Try to make a guess before you type this in. At the tutorial, the audience made a few reasonable guesses, namely: the last 2 paragraphs will be removed, only &#8220;hello world&#8221; will remain. Or: all paragraphs will be changed to &#8220;hello world&#8221;.<br />
Either could happen if d3 was trying to be smart and guess your intent. Fortunately, d3 is no excel here and behaves consistently even if that means extra work for you. When you do that (and please try this now) what happens is that the first paragraph of text is changed and the other two are untouched.</p>
<p>We are in the case, change the matched elements, ignore the others. </p>
<p>By the way, by now you should be able to guess what would have happened if there had been an enter() right after the data. Do I hear&#8230; nothing? almost! There would be no unmatched data element, so enter() would not return anything. Besides, enter() would require an append afterwards to make anything. This is why you&#8217;ll get an error: html can&#8217;t work directly after enter(). you would need an append. </p>
<p>Now what if we want to remove the extra 2 elements? This is where the exit() method comes into play.<br />
exit() is pretty much to enter() what remove() is to append(). Kind of.</p>
<p>let&#8217;s see how this work by example.</p>
<p>let&#8217;s recreate our 3 p paragraphs just in case: </p>
<pre class="brush: jscript; title: ; notranslate" title="">d3.selectAll(&quot;p&quot;).remove();
d3.select(&quot;body&quot;).selectAll(&quot;p&quot;).data(text).enter().append(&quot;p&quot;).html(String);</pre>
<p>Now we pass the new dataset:</p>
<pre class="brush: jscript; title: ; notranslate" title="">d3.selectAll(&quot;p&quot;).data(text2).html(String)</pre>
<p> &#8211; remember that only the first paragraph has changed, the other two are untouched.<br />
Now, while all the items in the dataset are matched with elements, there are elements which are not matched with an item in the dataset: the last two. This is where exit() comes into play. exit() will select those two paragraphs, so they can be manipulated. Typically, what happens then is a remove(), but you could think of other options.</p>
<pre class="brush: jscript; title: ; notranslate" title="">d3.selectAll(&quot;p&quot;).data(text2).exit().style(&quot;color&quot;,&quot;red&quot;);</pre>
<p>That will flag them instead of removing them.<br />
But typically, you do: </p>
<pre class="brush: jscript; title: ; notranslate" title="">d3.selectAll(&quot;p&quot;).data(text2).exit().remove();</pre>
<p>. </p>
<p>note that even though you have already matched a one item dataset to that selection, to use exit(), you will need to use data before. selectAll(&#8220;p&#8221;).exit() won&#8217;t work. You&#8217;ll have to re-specify the data match. </p>
<p>So that takes care of the case when you want to remove extraneous data items.<br />
This leaves us with only one simple case: where you have more items in your dataset than you have elements and you don&#8217;t want to create elements for the extra data items.<br />
That&#8217;s the simplest syntax, really.</p>
<p>Here, for instance, we have only one paragraph left, but there are 3 items in the text variable.<br />
so let&#8217;s do: </p>
<pre class="brush: jscript; title: ; notranslate" title="">d3.selectAll(&quot;p&quot;).data(text).html(String)</pre>
<p> (no enter, no exit, no append).<br />
The paragraph text will now come from the new dataset (from its first item to be precise), no extra paragraphs will be created, none will be deleted.</p>
<h3>Data joins</h3>
<p>the last case (pass a new dataset, create new elements as needed, make some elements stay and make some elements go) requires more complexity and actually I won&#8217;t cover it in detail here, instead I will explain the principle and refer you to this tutorial on <a href="http://bost.ocks.org/mike/constancy/" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://bost.ocks.org']);">object constancy</a> by Mike Bostock.<br />
In the general case, when you try to match your dataset to your elements, you count them and deal with the difference. So you have 5 data items and 3 elements: you can make 2 extra elements appear by using enter. With the concept of data joins, you can assign precisely each data item to one given element, so the first data item doesn&#8217;t have to be that of the first element, etc. Well, the first time it will be, and each element will receive a key, a unique identifier from the dataset. If the dataset is subsequently updated, the element will only be matched if there is an item in the dataset with the same key. Else, it will be found by an exit() method. </p>
<p>And that&#8217;s the general gist of it.<br />
At Strata, we went further &#8211; we discussed interaction and transition, but that is downward trivial once you have understood &#8211; and by that, really understood, with all the implications and nuances &#8211; the selections.</p>
</div><h2>Interactive map of the subway</h2><div class="contenttext"><p>My last project is an interactive map of the Paris subway.<br />
<a href="http://www.jeromecukier.net/projects/metro/map.html" ><img src="http://i0.wp.com/jeromecukier.net/projects/metro/sshot.png" alt="Interacive subway map" data-recalc-dims="1" /></a></p>
<p><a href="http://www.jeromecukier.net/projects/metro/map.html" >Interactive subway map</a></p>
<p>Quite some time ago, I had seen Tom Carden&#8217;s <a href="http://www.tom-carden.co.uk/p5/tube_map_travel_times/applet/" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://www.tom-carden.co.uk']);">Tube Travel Times</a> and was fascinated. So while I initially had tried to do something different I ended up borrowing a lot of his design, so it wouldn&#8217;t be fair to start this post without acknowledging that.<br />
Then again, there are a few original things in this worth writing about.<br />
A subway system can be seen as a network of nodes and edges. Nodes would be the stations, and edges, the subway lines that connect them. Finding the shortest path between two parts of the graph is a classic problem of computer science. That path is the sum of the length of all the edges it takes to traverse the graph from the source to the destination.<br />
However a typical subway journey, and I should know, is not entirely spent in a train. You first have to get from the street to the platform, wait for your train; in the event of a connection, you have to go from one platform to another, wait for another train; and eventually you have to return to the street level.<br />
So in my representation of the subway system in addition to the stations themselves, I&#8217;ve added nodes for all the platforms within a station and edges between them. So if you have to go from one station A to station B, which is three stops away on a given subway line, you would really traverse 5 edges: station A to platform, stop 1, stop 2, stop 3, then platform to station B.<br />
While the Paris subway agency, RATP, has recently publicized its open data intent, the travel times between two stations are not public. I actually had reliable and accurate measured travel times for 90% of the network, on the basis of which I could estimate the rest. The great unknown that remains is the complexity of the stations, some are very straightforward so going from the street to a train is a matter of seconds, while some are downright mazes. While I think I have travelled through almost every stations by now, I definitely not have stopped in many of them. So as part of the project I am asking users to complement my data on the stations they know well. Actually, I didn&#8217;t use much of the datasets that RATP published. The position of the stations on the canonical plan has a lot of inaccuracies. For the geographical positions I used my own measures rather than the published data (I had been playing on and off with subway data for close to 5 years now, <a href="http://www.openprocessing.org/sketch/22252" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://www.openprocessing.org']);">http://www.openprocessing.org/sketch/22252</a>). I did use the trafic data to give an idea of the occupancy of a given section, and the official color codes as well. Because I am using my own measures, I have not added other railway systems like the RER or tramway for which I don&#8217;t have enough data. </p>
<p>So when a user selects a station, the rest of the network moves according to their (shortest path) distance to the selected station. So at the heart of the exercise there is a shortest path calculation from any station to any other. Including stations, platforms, connections, entrances and exits, that&#8217;s a network of 680 nodes and 1710 edges (for 299 stations, I didn&#8217;t include a couple of the very last ones). And it&#8217;s a directed network, because there are some sections which go in only one direction. At most, a network that big could have close to 500,000 edges, so it&#8217;s fairly sparse.<br />
There are several algorithms to compute shortest paths in the code. I am using the best known one, Dijkstra, which works on path with no negative edge length. The way it is implemented here, with binary heaps, makes it so fast that it&#8217;s not noticeable. Not using that improvement, or relying on a more versatile but slower shortest path algorithm, would result in considerably greater computing times. </p>
<p>When a user selects one station a few things happen. First, all of the others are arranged around the selected station. Imagine the station is the fixed point in a polar coordinate system, all the other stations retain their angular coordinate but their radii now depends on the shortest path time. That idea came directly from Tom&#8217;s applet. Another thing I took from him is the addition of rings in the background which give an indication of the travelling time to those destinations. But I settled for that after much fumbling and with the conviction that there was no better solution.<br />
What also happens is that all the edges which are not part of any shortest path disappear. So subway lines are no longer continuous.<br />
Once a station is selected, more things happen when hovering on a second station, the actual shortest path is revealed while all others fade out, and the station marks are hidden except those of the start, destination and all connections on the way, for which names are displayed.<br />
Finally, an interace appears that let users enter estimations for the times I don&#8217;t know so well about the stations. I haven&#8217;t added any hard figures there so I am only asking for impressions, but I believe that with some usage the time estimations can get much more accurate. </p>
<hr />
<strong>Edit 1</strong><br />
the vis has been quite successful, so I decided to awesomize it a bit.<br />
Now by clicking on any colored line, it&#8217;s possible to &#8220;block&#8221; any given subway section. The shortest routes become those which do not go through that section. You can simulate what happens, for instance, when a given line is down.<br />
The other change is that I&#8217;ve added walking distances. For each station I&#8217;ve computed the beeline distance with its 5 nearest neighbors. I&#8217;ve translated that distance into time (knowing that pedestrians can&#8217;t traverse buildings, have to mind trafic etc.).<br />
But in many cases it is still quicker to go from one station to the next on foot than by train.</p>
</div><h2>Gun murders in America</h2><div class="contenttext"><p><a href="http://bit.ly/gunviolence" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://bit.ly']);"><img src="http://i1.wp.com/jeromecukier.net/projects/crime/murders.png?resize=800%2C513" class="aligncenter" data-recalc-dims="1" /></a><br />
<a href="http://bit.ly/gunviolence" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://bit.ly']);"><strong>Click for interactive visualization</strong></a></p>
<p>I have created this map of every homicide in the USA using firearms for the latest year where detailed information was available. Every, that is from all the agencies that report homicides to the FBI, which is not an obligation &#8211; this is why the map lacks Florida data.<br />
In the interactive version you can see how murders happen through the year and explore them according to several criteria that were available in the database. While large shooting sprees receive media attention, unfortunately there are thousands of cases each year in just about every community.<br />
Technically this is my first foray with <a href="http://d3js.org" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://d3js.org']);">d3.v3</a> and it uses two of its major new features, topoJSON for easy, lightweight maps, and hex binning to represent many individual events in one hexagon. Thanks to Mike Bostock for tutoring on that.</p>
</div><h2>Events in the Game of Thrones</h2><div class="contenttext"><p><div id="attachment_1518" class="wp-caption aligncenter" style="width: 745px"><a href="http://www.jeromecukier.net/projects/agot/events.html" ><img class="size-full wp-image-1518" title="Events in a Game of Thrones" src="http://i2.wp.com/www.jeromecukier.net/wp-content/uploads/2012/12/GoTviz.png?resize=735%2C692" alt="Events in a Game of Thrones" data-recalc-dims="1" /></a><p class="wp-caption-text">Click for the interactive version</p></div></p>
<p>I&#8217;ve created an <a href="http://www.jeromecukier.net/projects/agot/events.html" >interactive visualization</a> on the Game of Thrones.</p>
<p>(A more technical post on how this was done to follow)</p>
</div><h2>La nuit blanche</h2><div class="contenttext"><p>TL;DR: go check the model <a href="http://www.jeromecukier.net/projects/models/nuitblanche.html" >here</a> </p>
<p>So I live in Paris and try to go to the museums there as much as I can, which is often.<br />
About ten years ago (2002, I think) the city came up with what I thought was a fantastic idea: &#8220;nuit blanche&#8221;, an art event during one night in October. There were a dozen or so exhibits planned, all of which were fairly ambitious. For instance <a href="http://fr.wikipedia.org/wiki/Sophie_Calle" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://fr.wikipedia.org']);">Sophie Calle</a> would welcome visitors on a secret bedroom on the very top of the Eiffel tower.</p>
<p>When I saw the programme it was almost to good to be true: all those world class artists would do something extraordinary in Paris! I thought I could just casually walk all night from one installation to another along with a few other like-minded night wanderers. so it would look a bit like this: </p>
<p><iframe src="http://www.jeromecukier.net/projects/models/smallnb.html#night=300&#038;duration=50&#038;nbPeople=100&#038;step=15&#038;stepStd=1&#038;timePerVisit=10&#038;timePerVisitO=1&#038;nbAttractions=10&#038;o=0&#038;minCap=100&#038;maxCap=100&#038;mode=true&#038;lyak=true" width="520" height="650" frameborder="0" scrolling="no" marginheight="0" marginwidth="0"></iframe><br />
(how to read this: circles are installations. The large black circle represents their capacity, the inner green circle the occupancy. If too many people try to enter an installation, the green circle will grow larger than the black one and will turn red, this is when queuing appears. Dots represent visitors).</p>
<p>Little did I know that the city expected 100000 visitors. Actually, 1 million showed up. </p>
<p><iframe src="http://www.jeromecukier.net/projects/models/smallnb.html#night=300&#038;duration=50&#038;nbPeople=1000&#038;step=15&#038;stepStd=1&#038;timePerVisit=20&#038;timePerVisitO=2&#038;nbAttractions=10&#038;o=0&#038;minCap=10&#038;maxCap=30&#038;mode=true&#038;lyak=true" width="520" height="650" frameborder="0" scrolling="no" marginheight="0" marginwidth="0"></iframe></p>
<p>If the total number of visitors that were in the streets at one given moment in time is an indication of success, Nuit Blanche has been fantastic. But to anybody who&#8217;s experienced it it was really a night of waiting and walking. There just wasn&#8217;t enough capacity in the various places that would host the event, and no way for a visitor to expect the size of the queue that they would be facing (more on that later).</p>
<p>Every year, it&#8217;s a struggle. I&#8217;m like, the programme is so exciting, but then I know I will spend my time queuing or walking (in later editions, public transportation got better, so let&#8217;s say queuing and moving). </p>
<p>And each year I end up going, and I end up thinking: never again. (but <a href="http://www.micheldebroin.org/projects/nuitblanche/4.html" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://www.micheldebroin.org']);">hey</a>, <a href="http://www.ryojiikeda.com/project/spectra/#spectra_paris" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://www.ryojiikeda.com']);">hey</a>, and <a href="http://www.leandroerlich.com.ar/works.php?id=27" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://www.leandroerlich.com.ar']);">hey</a>). </p>
<p>In the last edition there&#8217;s been something like 2.5 million visitors. There are about 100 places to visit in Paris. Many of which are indoors with a limited capacity and so enforce queues. Some are outside, so people can just walk past it and enjoy the art (sometimes, even from a great distance). </p>
<p>What I found annoying though it that there was no way to tell in advance which installations were going to be crowded, and which were going to be empty.<br />
This is what led me to build this model. </p>
<p><iframe src="http://www.jeromecukier.net/projects/models/smallnb.html#night=500&#038;duration=100&#038;nbPeople=2500&#038;step=10&#038;stepStd=1&#038;timePerVisit=20&#038;timePerVisitO=2&#038;nbAttractions=100&#038;o=0.2&#038;minCap=5&#038;maxCap=20&#038;mode=true&#038;lyak=false" width="520" height="650" frameborder="0" scrolling="no" marginheight="0" marginwidth="0"></iframe></p>
<p>Here&#8217;s how it works.<br />
A certain number of people and attractions are randomly distributed in the city.<br />
People will go to the nearest attraction. If it&#8217;s possible, they will go in, else they will queue until there is room.<br />
While inside, they will enjoy it for a certain time, then they will move out and go to the nearest one they haven&#8217;t visited. </p>
<p>This model, which is fairly close to how things work currently, will always end up creating large queues in some places while others will run under capacity.<br />
<iframe src="http://www.jeromecukier.net/projects/models/smallnb.html#night=500&#038;duration=100&#038;nbPeople=2500&#038;step=10&#038;stepStd=1&#038;timePerVisit=20&#038;timePerVisitO=2&#038;nbAttractions=100&#038;o=0.2&#038;minCap=5&#038;maxCap=20&#038;mode=true&#038;lyak=true" width="520" height="650" frameborder="0" scrolling="no" marginheight="0" marginwidth="0"></iframe><br />
Now imagine a simple change: people get an idea of how long the queues are everywhere. Instead of going to the nearest exhibit, they will go to the place where they would be able to get in the quickest, taking into account the time to get there and the time to queue if applicable. Since nobody likes to wait, people will shy away from the places with long queues, evening the load, and by the same token reducing the waiting time for other visitors. Technically the waiting time at all the installations become <a href="http://en.wikipedia.org/wiki/Lyapunov_function" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://en.wikipedia.org']);">Lyapunov functions</a>, and provided they have enough information agents will make it optimal.</p>
<p>If you run this model in <a href="http://www.jeromecukier.net/projects/models/nuitblanche.html#night=500&#038;duration=100&#038;nbPeople=2500&#038;step=5&#038;stepStd=1&#038;timePerVisit=20&#038;timePerVisitO=2&#038;nbAttractions=50&#038;o=0.2&#038;minCap=5&#038;maxCap=20&#038;mode=true&#038;lyak=true" >its full screen incarnation</a> with dashboards, bells and whistles, you will see that this doesn&#8217;t really help increasing the number of installations that people get to visit. What happens is that the time spent waiting in queue shifts to time spent moving between places. (the overall time spent inside installations should increase, though).</p>
<p>In order to reduce the time spent moving, one can improve the public transportation (represented by the average speed, in the model), or putting installations close together, which has been done to some extent since the start. But do that with a limit, because that moving time is an interesting buffer, it&#8217;s not as annoying as queuing and Paris is beautiful at night, and when you&#8217;re among 2.5 million art enthousiasts it&#8217;s as safe a city can get. </p>
<p>To further improve the time spent visiting exhibits, one has to improve capacity or reduce attendance (two options which I trust the city of Paris will be wary about). One other option would be to improve the percentage of art installations that can be enjoyed from the outside, another parameter in the simulation.</p>
<p>Lastly, here are a few things the model doesn&#8217;t include, which IMO don&#8217;t make a lot of difference in the results, but to be honest:<br />
- the installations are presented as being equally attractive. In fact, some are always more interesting than others and get even more queue. (that would make the model where queues are ignored even more unbalanced).<br />
- the capacities of the installations are determined by random, but uniformly distributed. That isn&#8217;t the case, the largest museums are open that night and they can welcome thousands of visitors, while some other places would be full at 100.<br />
- opening times of installations haven&#8217;t been taken into account; most will close at some point during the night. </p>
<p>and on that note, <a href="http://www.jeromecukier.net/projects/models/nuitblanche.html" >enjoy the model</a> </p>
</div><h2>Some simulation models</h2><div class="contenttext"><p>Inspired by the <a href="http://coursera.org" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://coursera.org']);">coursera</a> class on <a href="https://class.coursera.org/modelthinking-2012-002/class/index" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://class.coursera.org']);">model thinking</a>, by Scott E Page, I have implemented a bunch of <a href="http://jeromecukier.net/projects/models/models.html" >simulation models</a> with <a href="http://d3js.org" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://d3js.org']);">d3</a>. It&#8217;s something I have done on and off for the past few weeks, and let&#8217;s say it&#8217;s really the first 6. Those interactive versions just graze the surface of all there is to see.</p>
<p>So what I have is: </p>
<ul>
<li><a href="http://www.jeromecukier.net/projects/models/life.html" >Conway&#8217;s game of life </a></li>
<li><a href="http://www.jeromecukier.net/projects/models/ca.html" >1D cellular automata </a></li>
<li><a href="http://www.jeromecukier.net/projects/models/polya.html" >Polya&#8217;s process </a></li>
<li><a href="http://www.jeromecukier.net/projects/models/percolate.html" >square lattice percolation model </a></li>
<li><a href="http://www.jeromecukier.net/projects/models/markov.html" >Markov processes </a></li>
<li><a href="http://www.jeromecukier.net/projects/models/segregate.html" >Schelling&#8217;s segregation model </a></li>
</ul>
<p>Enjoy!</p>
</div><h2>d3 tutorial at visWeek 2012</h2><div class="contenttext"><p>Jeff Heer, Scott Murray and myself have done a d3 tutorial at visWeek 2012. You probably gathered that from the title of the post.</p>
<p>Here is a link to all the slides and code examples that we have presented:</p>
<p><a href="http://www.jeromecukier.net/d3_tutorial.zip" onclick="javascript:_gaq.push(['_trackEvent','download','http://www.jeromecukier.net/d3_tutorial.zip']);">d3 tutorial</a></p>
<p>For the purpose of the tutorial I have compiled a d3 cheat sheet, on 4 pages it groups some of the most common d3 functions. When I was learning d3 my number one problem was figuring out which property should be set using .attr, and which required .style. And also: which svg element support which property? All of this is addressed in the cheat sheet. It&#8217;s part of the link above, but if you want it directly without downloading a 13Mb file, here it is: </p>
<p><a href="http://www.jeromecukier.net/wp-content/uploads/2012/10/d3-cheat-sheet.pdf" onclick="javascript:_gaq.push(['_trackEvent','download','http://www.jeromecukier.net/wp-content/uploads/2012/10/d3-cheat-sheet.pdf']);">d3 cheat sheet</a></p>
</div><h2>A game of data</h2><div class="contenttext"><p>Inspired by the, well, inspiring set of Lost visualizations released by Santiago Ortiz &#8211; <a href="http://intuitionanalytics.com/other/lostalgic/" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://intuitionanalytics.com']);">Lostalgic</a>, I decided to publish the one visualization on all the data I had gathered on the Song of Ice and Fire series of books.</p>
<p><a href="http://www.jeromecukier.net/projects/agot/places.html" ><img src="http://i2.wp.com/www.jeromecukier.net/wp-content/uploads/2012/10/places.png?resize=600%2C448" alt="" title="places" class="aligncenter size-full wp-image-1484" data-recalc-dims="1" /></a></p>
<p><a href="http://www.jeromecukier.net/projects/agot/places.html" >Click to see the vis</a></p>
<p>Here&#8217;s the idea behind this one. Many books set in a fantasy world come with a map where all the places mentioned in the books are situated. I end up looking up these places very often to get an idea for the distances, for instance. But the way these locations are placed on a map is one specific convention. If two places are supposed to be fairly close from each other on a map but that it is very inconvenient to travel from one to the other, it is as if they were far, and conversely, if two places are a world apart but travel between them is fast and easy, it is as if they were close. </p>
<p>With that in mind I am drawing a subjective map of the Game of Thrones world.<br />
In the books, chapters are broadly comparable. Since all chapters are narrated from the point of view of one character, I link two places between which this protagonist has travelled in the course of one chapter. I also add links for travels suggested in the chapter, even if not done by the point of view character.<br />
Places which are linked are drawn one to the other. As a result, this creates an alternate, abstract geography, where distances represent the difficulties and obstacles in travel, rather than distance in the territory.</p>
<p>In addition the size of the nodes depend on the number of times they are visited in the books. A node could be large even for a relatively empty place, if a lot of the action takes place there, this is true for Castle Winterfell or Castle Black. Then again, large cities which are alluded to in the story, but where not much happens in the books, such as Casterly Rock or Sunspear, will appear as tiny dots. King&#8217;s Landing, which is the settings of roughly 25% of the books, and also probably the largest city in this world, is the largest node.</p>
</div><h2>Dimensionality reduction</h2><div class="contenttext"><p>Following my <a href="http://www.jeromecukier.net/blog/2012/09/05/which-way-to-the-right/" >Tableau politics contest entry</a>, here is another view I had developed but which I didn&#8217;t include in the already full dashboard. </p>
<p><iframe style="border: 0px;" src="http://public.tableausoftware.com/views/politics/DR_EN" scrolling="no" width="710px" height="810px"></iframe></p>
<p>In the <a href="http://public.tableausoftware.com/views/politics/DashEN" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://public.tableausoftware.com']);">main view</a> I have tried to show how the values of candidates relate to those of the French. It&#8217;s difficult to convey that graphically when these values are determined by the answers to as many as 19 questions (and there are many many more that could be used to that effect).</p>
<p>Enter a technique called dimensionality reduction. The idea is to turn a dataset with many dimensions into a dataset with much fewer dimensions, as little as one, two or three. So we compute new variables, so that they capture virtually all the variability of the original dataset. In other words, if two records have different values in the original dataset, they should have different values in the transformed dataset too. </p>
<p>If you&#8217;re not allergic to words like eigenvalues the math <a href="http://en.wikipedia.org/wiki/Principal_component_analysis" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://en.wikipedia.org']);">is actually pretty simple</a>. But let&#8217;s not go into that. The point is that with this technique <strong>you can represent a complex dataset as a two-dimensional dataset with very little loss</strong>.</p>
<p>Of course the technique doesn&#8217;t tell you what these new variables represent. Getting a feel for the data I postulate that the one on the X axis represents the toughness of a candidate (pro-security measures, no sensitivity for minorities, etc.) and the one on the Y axis is happiness with previous government. Or possibly, lover of the capitalistic doctrine.</p>
<p>Now you get a better feel for how close or distant the various candidates are from individual voters. You can also see which &#8220;spaces&#8221; remain empty or which are competitive. The top-right quadrant, for instance, looks tempting, but it is really nearly empty (about 200 respondents on over 1500). The right half of the matrix, that is the one which is sensitive to strength, has only one possible competitor but also few voters (~400 respondents). It makes more sense to remain an acceptable choice for the top half (750 voters) and especially the top left (550). In other words the Sarkozy mark should drift slightly towards the top left for optimal impact.</p>
</div><h2>Tableau 2012 politics contest &#8211; justification and making-of</h2><div class="contenttext"><h2>what led me to those choices</h2>
<p>I was technically happy of my entry for the <a href="http://www.jeromecukier.net/blog/2012/06/30/tableau-2012-sports-visualization-contest-entry/" >sports contest</a>. I had done what I wanted: obtain a hard-to-find, interesting dataset, attempt to create an exotic, hard-to-make and never-tableau&#8217;d-before shape with aesthetic appeal and insights.</p>
<p>Yet the rules stated that the entries shall be judged on the story-telling front. While there were interesting insights, indeed, they didn&#8217;t constitute a story, a structured narration with a beginning and an end. Having <a href="http://thevcl.com/storytelling/" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://thevcl.com']);">worked</a> <a href="http://flowingdata.com/2011/11/04/telling-stories-with-data-visweek-2011/" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://flowingdata.com']);">on that subject</a> on occasion, I think there is an inherent contradiction between a dashboard tool that lets a user freely manipulate a bunch of data and that articulated story where the user is more led throughout a process.</p>
<p>So that&#8217;s what led most of the work.</p>
<p>The second idea was that there is an unspoken, but IMO unnecessary rule about making Tableau dashboards compact things, highly interactive and interconnected. First, the elephant in the room: Tableau public is slow. It&#8217;s too slow. So too many interactions do not make a pleasant experience. Second, it is true that in Tableau one <em>can</em> assemble a dashboard out of interconnected worksheets, where clicking on one makes things happen in another. But just because you can doesn&#8217;t mean you <em>should</em>. Remember the &lt;BLINK&gt; element in the webpage of the 1990s? And this is this interconnectivity that causes dashboards to be compact and fit over the fold. If clicking on one element causes changes on another, you&#8217;d better be able to see both even on a laptop screen.</p>
<p>So the second idea was to create instead a long dashboard where a user would be held by the hand as she&#8217;s taken from point A to point B. Along the way, there would be texts and images to explain what&#8217;s going on, data &#8211; not necessarily interconnected, worksheets with little interactivity which can be understood at first sight, and which can stand some manipulation but don&#8217;t need to.</p>
<p>When visualization and storytelling intersect <a href="http://www.slideshare.net/vozome/dont-take-my-word-for-it-10279298" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://www.slideshare.net']);">there is one form that I like</a> which is to start with a preconception and to let the user find through manipulation that this idea is wrong. So I tried to use that in the dashboard as well.</p>
<h2>The subject</h2>
<p>That&#8217;s actually the #1 issue in French politics right now. Which strategy should the main right-wing party adopt? Typically, during the presidential campaign, both large parties fight for the votes of the center and are less radical than usual. But during this campaign the UMP, the party of the former president Nicolas Sarkozy, steered hard to the right in an attempt to steal back the voters gone to the far-right.</p>
<p>Apparently, that strategy was successful, even if he lost the presidential rate, he managed to somehow catch up against his rival.</p>
<p>Yet there are those who argue that if the party was more moderate, it would have been more successful and possibly win.</p>
<p>Anyway. The presidential race is over. But now the party is deciding which way to go next by electing its next leader.</p>
<p>Fortunately, there is data that can be used to determine whether the far-right or the moderate strategy can be more fruitful. This is what it is about.</p>
<h2>Making the viz</h2>
<p>Tableau dashboards can go up to 4000px in height, so that&#8217;s what I shot for.</p>
<p>So let&#8217;s say it loud and clear, it&#8217;s hell to manipulate large dashboards in Tableau, even with a very strong computer. When you add a new worksheet the legend part and the quickfilter part are added whenever there is room which could be thousands of pixels away. Since you can&#8217;t drag an element across screens you may have to proceed in babysteps. Once there is a certain number of elements, be they text, blanks or very simple and stable worksheets, adding another element takes a very long time, so does moving them around, etc.</p>
<p>As usual fixed size is your only friend, fixed heights, fixed widths, alternating horizontal and vertical layout containers.</p>
<p>So up to the last 2 worksheets there is really nothing to write home about. Only this: when you interact on the published workbook on the web it is painstakingly slow as the dashboard is reloaded and recomputed in its entirety. While this is ok for most of the worksheet, for the most complex one (the one with many sliders) it&#8217;s just unacceptable because the sheet won&#8217;t have time to be redrawn between two interactions.</p>
<p>So I came up with an idea: create a secondary dashboard with just that sheet, publish it independently, and then, in the previous dashboard, I have added a web page object. And that web page pointed to that other dashboard. So in effect, there is a dashboard within a dashboard, so when there is interactions in the complex worksheet, the secondary, smaller dashboard is the only one which is reloaded and recomputed, which is noticeably faster. Still not faster as in fast, but usable.</p>
<p>now publishing aspects aside this worksheet is interesting. The idea is to update a model based on 19 criteria. For every record, the outcome depends the &#8220;closeness&#8221; of the answers of the record and those of the candidates. The 19 parameters control the position of one of the candidates: Nicolas Sarkozy. So what I&#8217;ve done is calculate, outside of Tableau, the &#8220;distance&#8221; between each record and each of the other 8, and in the data file, I&#8217;ve specified that minimal distance and the name of the corresponding candidate. Then, in Tableau, I compute in real time the distance between the record and the parameters, and if that score is inferior to the threshold in the data file, then Sarkozy is deemed to be the closest, else it is the one from the data file. The worksheet tallies up the number of records which are closest to each candidate. Also, in order to keep the parameters legible I have constrained them to 9 values, when they really represent numbers between -2 and 2.</p>
<p>Also for the record, I have made a French and an English version. Why? Because I hope to get the French version published in a media and weight in on the debate, while I need the English version for the contest. This raises a lot of issues, all the worksheets need to exist in 2 versions, many variables need to be duplicated as well. As a sidenote the marks concerning a candidate are colored in tableau blue /orange in English in order to highlight candidate Sarkozy, but according to the campaign colors of the candidates in the French version.</p>
<p>That&#8217;s about it. I hope you enjoy my viz!</p>
</div></div><div id="sidebar">

<div id="text-4" class="widget_text">			<div class="textwidget"><a href="http://twitter.com/jcukier" onclick="javascript:_gaq.push(['_trackEvent','outbound-widget','http://twitter.com']);" class="twitter-follow-button">Follow @jcukier</a>
<script src="http://platform.twitter.com/widgets.js" type="text/javascript"></script></div>
		</div><div id="pages-2" class="widget_pages"><h2>Pages</h2>		<ul>
			<li class="page_item page-item-2"><a href="http://www.jeromecukier.net/about/">About</a></li>
<li class="page_item page-item-1073"><a href="http://www.jeromecukier.net/data-stories/">Data with stories workshop &#8211; examples</a></li>
<li class="page_item page-item-437"><a href="http://www.jeromecukier.net/proofs-of-concept/">Private section</a></li>
		</ul>
		</div><div id="calendar-2" class="widget_calendar"><div id="calendar_wrap"><table id="wp-calendar">
	<caption>March 2013</caption>
	<thead>
	<tr>
		<th scope="col" title="Monday">M</th>
		<th scope="col" title="Tuesday">T</th>
		<th scope="col" title="Wednesday">W</th>
		<th scope="col" title="Thursday">T</th>
		<th scope="col" title="Friday">F</th>
		<th scope="col" title="Saturday">S</th>
		<th scope="col" title="Sunday">S</th>
	</tr>
	</thead>

	<tfoot>
	<tr>
		<td colspan="3" id="prev"><a href="http://www.jeromecukier.net/blog/2013/01/" title="View posts for January 2013">&laquo; Jan</a></td>
		<td class="pad">&nbsp;</td>
		<td colspan="3" id="next" class="pad">&nbsp;</td>
	</tr>
	</tfoot>

	<tbody>
	<tr>
		<td colspan="4" class="pad">&nbsp;</td><td>1</td><td>2</td><td>3</td>
	</tr>
	<tr>
		<td>4</td><td><a href="http://www.jeromecukier.net/blog/2013/03/05/" title="Selections in d3 &#8211; the long story">5</a></td><td>6</td><td>7</td><td>8</td><td>9</td><td>10</td>
	</tr>
	<tr>
		<td>11</td><td>12</td><td>13</td><td>14</td><td>15</td><td>16</td><td>17</td>
	</tr>
	<tr>
		<td>18</td><td>19</td><td>20</td><td>21</td><td>22</td><td>23</td><td>24</td>
	</tr>
	<tr>
		<td>25</td><td>26</td><td>27</td><td>28</td><td id="today">29</td><td>30</td><td>31</td>
	</tr>
	</tbody>
	</table></div></div><div id="archives-2" class="widget_archive"><h2>Archives</h2>		<ul>
			<li><a href='http://www.jeromecukier.net/blog/2013/03/' title='March 2013'>March 2013</a></li>
	<li><a href='http://www.jeromecukier.net/blog/2013/01/' title='January 2013'>January 2013</a></li>
	<li><a href='http://www.jeromecukier.net/blog/2012/12/' title='December 2012'>December 2012</a></li>
	<li><a href='http://www.jeromecukier.net/blog/2012/11/' title='November 2012'>November 2012</a></li>
	<li><a href='http://www.jeromecukier.net/blog/2012/10/' title='October 2012'>October 2012</a></li>
	<li><a href='http://www.jeromecukier.net/blog/2012/09/' title='September 2012'>September 2012</a></li>
	<li><a href='http://www.jeromecukier.net/blog/2012/07/' title='July 2012'>July 2012</a></li>
	<li><a href='http://www.jeromecukier.net/blog/2012/06/' title='June 2012'>June 2012</a></li>
	<li><a href='http://www.jeromecukier.net/blog/2012/05/' title='May 2012'>May 2012</a></li>
	<li><a href='http://www.jeromecukier.net/blog/2012/04/' title='April 2012'>April 2012</a></li>
	<li><a href='http://www.jeromecukier.net/blog/2012/01/' title='January 2012'>January 2012</a></li>
	<li><a href='http://www.jeromecukier.net/blog/2011/11/' title='November 2011'>November 2011</a></li>
	<li><a href='http://www.jeromecukier.net/blog/2011/10/' title='October 2011'>October 2011</a></li>
	<li><a href='http://www.jeromecukier.net/blog/2011/09/' title='September 2011'>September 2011</a></li>
	<li><a href='http://www.jeromecukier.net/blog/2011/08/' title='August 2011'>August 2011</a></li>
	<li><a href='http://www.jeromecukier.net/blog/2011/07/' title='July 2011'>July 2011</a></li>
	<li><a href='http://www.jeromecukier.net/blog/2011/06/' title='June 2011'>June 2011</a></li>
	<li><a href='http://www.jeromecukier.net/blog/2011/05/' title='May 2011'>May 2011</a></li>
	<li><a href='http://www.jeromecukier.net/blog/2011/04/' title='April 2011'>April 2011</a></li>
	<li><a href='http://www.jeromecukier.net/blog/2011/03/' title='March 2011'>March 2011</a></li>
	<li><a href='http://www.jeromecukier.net/blog/2011/02/' title='February 2011'>February 2011</a></li>
	<li><a href='http://www.jeromecukier.net/blog/2011/01/' title='January 2011'>January 2011</a></li>
	<li><a href='http://www.jeromecukier.net/blog/2010/11/' title='November 2010'>November 2010</a></li>
	<li><a href='http://www.jeromecukier.net/blog/2010/04/' title='April 2010'>April 2010</a></li>
	<li><a href='http://www.jeromecukier.net/blog/2010/03/' title='March 2010'>March 2010</a></li>
	<li><a href='http://www.jeromecukier.net/blog/2010/02/' title='February 2010'>February 2010</a></li>
	<li><a href='http://www.jeromecukier.net/blog/2010/01/' title='January 2010'>January 2010</a></li>
	<li><a href='http://www.jeromecukier.net/blog/2009/12/' title='December 2009'>December 2009</a></li>
	<li><a href='http://www.jeromecukier.net/blog/2009/10/' title='October 2009'>October 2009</a></li>
	<li><a href='http://www.jeromecukier.net/blog/2009/09/' title='September 2009'>September 2009</a></li>
	<li><a href='http://www.jeromecukier.net/blog/2009/08/' title='August 2009'>August 2009</a></li>
	<li><a href='http://www.jeromecukier.net/blog/2009/07/' title='July 2009'>July 2009</a></li>
	<li><a href='http://www.jeromecukier.net/blog/2009/06/' title='June 2009'>June 2009</a></li>
	<li><a href='http://www.jeromecukier.net/blog/2009/05/' title='May 2009'>May 2009</a></li>
	<li><a href='http://www.jeromecukier.net/blog/2008/12/' title='December 2008'>December 2008</a></li>
	<li><a href='http://www.jeromecukier.net/blog/2008/11/' title='November 2008'>November 2008</a></li>
	<li><a href='http://www.jeromecukier.net/blog/2008/10/' title='October 2008'>October 2008</a></li>
		</ul>
</div></div><div id="footer">
<p>&copy; 2013 Jerome Cukier | <a href="http://www.jeromecukier.net/feed/">Entries (RSS)</a> | <a href="http://www.jeromecukier.net/comments/feed/">Comments (RSS)</a> | <a href="http://www.jeromecukier.net/wp-login.php">Log in</a><br />
<span>Powered by <a href="http://wordpress.org/">WordPress</a> | <a href="http://andreasviklund.com/wordpress-themes/">Theme design</a> by <a href="http://andreasviklund.com/" title="Original theme design by Andreas Viklund">Andreas Viklund</a></span></p>
</div>
	<div style="display:none">
	</div>
<script type='text/javascript' src='http://www.jeromecukier.net/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shCore.js?ver=3.0.83c'></script>
<script type='text/javascript' src='http://www.jeromecukier.net/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushJScript.js?ver=3.0.83c'></script>
<script type='text/javascript'>
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "http://www.jeromecukier.net/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.83c";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "http://www.jeromecukier.net/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css?ver=3.0.83c";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['auto-links'] = false;
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.defaults['smart-tabs'] = false;
	SyntaxHighlighter.defaults['toolbar'] = false;
	SyntaxHighlighter.all();
</script>
<script type='text/javascript' src='http://www.jeromecukier.net/wp-content/plugins/jetpack/modules/photon/photon.js?ver=20121206'></script>
<script type='text/javascript' src='http://s0.wp.com/wp-content/js/devicepx-jetpack.js?ver=201313'></script>
<script type='text/javascript' src='http://s.gravatar.com/js/gprofiles.js?ver=2013Maraa'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var WPGroHo = {"my_hash":""};
/* ]]> */
</script>
<script type='text/javascript' src='http://www.jeromecukier.net/wp-content/plugins/jetpack/modules/wpgroho.js?ver=3.5'></script>

	<script src="http://stats.wordpress.com/e-201313.js" type="text/javascript"></script>
	<script type="text/javascript">
	st_go({v:'ext',j:'1:2.1.1',blog:'5743122',post:'0',tz:'2'});
	var load_cmc = function(){linktracker_init(5743122,0,2);};
	if ( typeof addLoadEvent != 'undefined' ) addLoadEvent(load_cmc);
	else load_cmc();
	</script></div>
</body>
</html> 